SC.MODULE_INFO['cloudkit/photo'].source = "(function(){var a=\"cloudkit/photo/photoPicker\";if(!SC.MODULE_INFO){throw\"SC.MODULE_INFO is not defined!\"}if(SC.MODULE_INFO[a]){return}SC.MODULE_INFO[a]=SC.Object.create({dependencies:[],styles:[\"../../../../system/steedos/4130/cloudkit/photo/photoPicker/4130/zh-cn/stylesheet.css\"],styles2x:[\"../../../../system/steedos/4130/cloudkit/photo/photoPicker/4130/zh-cn/stylesheet@2x.css\"],scriptURL:\"../../../../system/steedos/4130/cloudkit/photo/photoPicker/4130/zh-cn/javascript.js\",stringURL:\"../../../../system/steedos/4130/cloudkit/photo/photoPicker/4130/zh-cn/javascript-strings.js\",isPrefetched:YES})})();SC.stringsFor(\"en-us\",{\"Dialog.Photo.UploadError.Title\":\"Could Not Upload Photo\",\"Dialog.Photo.UploadError.Text\":\"There was a server error.\",\"Dialog.Photo.UploadError.TooLarge.Text\":\"The image you are trying to upload is too large. Maximum file size allowed is 10 megabytes.\",\"Dialog.Photo.UploadError.Close\":\"Close\",\"Dialog.Photo.UnsupportedFile.Text\":\"Make sure the format of your photo is JPEG, GIF, PNG or BMP.\"});CK.Photo=SC.Object.create({defaultAlertIconHash:{value:\"me-icon-alert-68\",width:68,height:65},PHOTOPICKER_DRAGPHOTOTEXT_XPOS:112,PHOTOPICKER_DRAGPHOTOTEXT_YPOS:93,CANVAS_IMG_HEIGHT:220,CANVAS_IMG_WIDTH:220,CANVAS_INITIAL_HEIGHT:220,CANVAS_INITIAL_WIDTH:220,CANVAS_DEFAULT_LAYOUT_HEIGHT:220,CANVAS_DEFAULT_LAYOUT_WIDTH:220,CONTACT_PHOTO_HEIGHT:220,CONTACT_PHOTO_WIDTH:220,PHOTO_NO_ERROR:0,PHOTO_INVALID_FORMAT:1,PHOTO_SIZE_TOO_BIG:2,PHOTO_SERVER_ERROR:3,PHOTO_INSTALL_PLUGIN:4,PHOTO_LOAD_ERROR:5,isFileDroppedAValidImage:function(f,d){if(!f||SC.typeOf(d)!==SC.T_ARRAY){return}var e=f.fileType||f.type;e=e&&e.indexOf(\"/\")!==-1?e.split(\"/\")[1]:e;return e&&d.indexOf(e)!==-1},displayUploaderErrors:function(c){if(!c){return}var d;switch(c){case 1:d=\"invalidFormat\";break;case 2:d=\"photoIsTooBig\";break}PhotoPicker.statechart.sendEvent(d)}});CK.Photo.CanvasImage={imgHeight:64,imgWidth:64,initialWidth:64,initialHeight:64,dimensions:{width:64,height:64},boundaryRadius:3,editView:null,staticImage:null,editViewIsVisible:NO,editShadeImage:null,repositionImage:function(){var I=this.get(\"imgHeight\"),M=this.get(\"imgWidth\"),i=this.get(\"imgLoadError\")?null:this.get(\"value\"),E=i?i:this.get(\"staticImage\"),y=i?this.get(\"photoCrop\"):null,S=this.get(\"initialWidth\"),D=this.get(\"initialHeight\"),P=this.get(\"dimensions\"),N=this.get(\"editShadeImage\"),T=this.get(\"editView\"),H=this.get(\"innerBoundaryRect\"),x=this.get(\"boundaryRadius\");if(y){if((y.x+y.width)>M){y.x=0;y.width=M}if((y.y+y.height)>I){y.y=0;y.height=I}}var X=y&&i?y.width:null,V=y&&i?y.height:null,L=X?P.width/X:S/M,U=V?P.height/V:D/I,Q=i?Math.round(M*L):P.width,W=i?Math.round(I*U):P.height,J=i&&y?-y.x*L:-(S-P.width)/2,K=i&&y?-(W-y.y*U-P.height):-(D-P.height)/2,O=this.get(\"raphael\"),G=this.get(\"img\");M=M>S?M:Q;I=I>D?I:W;this.set(\"imgWidth\",M);this.set(\"imgHeight\",I);if(O){this.set(\"moveX\",J);this.set(\"moveY\",K);if(Q===0){Q=S;SC.error(\"The photo crop properties got are wrong. crop-width = %@\".fmt(X))}if(W===0){W=S;SC.error(\"The photo crop properties got are wrong. crop-height = %@\".fmt(V))}var A=\"0, 0, %@, %@, %@\".fmt(P.width,P.height,x);if(!G){G=O.image(E,J*S/Q,K*D/W,S,D);G.attr({r:x,\"clip-rect\":A});this.set(\"img\",G)}else{G.scale(1,1);G.attr({width:S,height:D,x:J*S/Q,y:K*D/W,src:E});if(!G.attr(\"clip-rect\")){G.attr({\"clip-rect\":A})}if(!y){this.set(\"zoomLevel\",0)}}if(this.get(\"imgOrientation\")){this.setupOrientation()}if(y){var F=this.get(\"zoomLevel\"),R=F;if(M!==S){R=Math.round((Q-S)*100/(M-S))}else{R=0}if(R===F){this.notifyPropertyChange(\"zoomLevel\")}else{this.set(\"zoomLevel\",R)}}G.show();this.createInnerBoundaryRect(O);if(i){if(T){N=this.createEditView(O,P,x);if(N){if(this.get(\"editViewIsVisible\")){G.toBack()}}else{SC.error(\"The Edit View provided does not have the properties image and rect\")}}}else{if(!i){if(N){N.hide()}}}}},computedForRaphael:function(f,d,e){return Math.ceil((d-f-e)*e/d)},setImageWidthAndHeight:function(i,j,h,k){var g=document.createElement(\"img\");g.onload=function(){if(j.get(\"value\")===i){j.set(\"imgHeight\",this.height||this.naturalHeight);j.set(\"imgWidth\",this.width||this.naturalWidth);j.set(\"imgLoadError\",NO);if(h){j.tryToPerform(h,i)}}if(this.parentNode){this.parentNode.removeChild(this)}};var l=function(){if(this.naturalHeight===0||this.naturalWidth===0){if(j.get(\"value\")===i){if(j.resetInitialValues){j.resetInitialValues()}j.set(\"imgLoadError\",YES);if(k){j.tryToPerform(k,i)}}if(this.parentNode){this.parentNode.removeChild(this)}}};$(g).bind(\"error\",l);g.style.cssText=\"top:-10000px; left: -10000px;  position: absolute;\";g.src=i;g.id=\"dummyImg\";document.body.appendChild(g)},setupInitialDimensions:function(s,r,i){var B=this.get(\"dimensions\"),x,A,q=s,u=r,t=this.get(\"photoCrop\"),v,y,p=s/r,z=B.width,w=B.height;if(i){q*=2;u*=2;if(p>1){if(u<w){u=w;q=u*p}}else{if(q<z){q=z;u=q*p}}this.set(\"imgWidth\",q);this.set(\"imgHeight\",u);this.set(\"convertToSmallerSizeRatio\",y=q/s);if(t){v={x:t.x*y,y:t.y*y,width:t.width*y,height:t.height*y};this.set(\"photoCrop\",v)}}x=q>=u?w:Math.round((u*w)/q);A=u>=q?z:Math.round((q*z)/u);this.set(\"initialWidth\",A);this.set(\"initialHeight\",x)},horizontalScale:function(){var d=this.get(\"imgWidth\"),c=this.get(\"initialWidth\");if(d&&c&&d>=c){return(d-c)/100}else{return 0}}.property(\"imgWidth\",\"initialWidth\"),verticalScale:function(){var d=this.get(\"imgHeight\"),c=this.get(\"initialHeight\");if(d&&c&&d>=c){return(d-c)/100}else{return 0}}.property(\"imgHeight\",\"initialHeight\"),imageIsSmallerThenCanvas:function(){var c=this.get(\"verticalScale\"),d=this.get(\"horizontalScale\");return c===0||d===0}.property(\"verticalScale\",\"horizontalScale\"),zoomLevelDidChange:function(){var i=this.get(\"raphael\"),s=this.get(\"img\"),q=this.get(\"horizontalScale\"),o=this.get(\"verticalScale\"),t=this.get(\"zoomLevel\"),r=this.get(\"initialHeight\"),v=this.get(\"initialWidth\"),z=this.get(\"dimensions\"),y=s?s.attr(\"width\"):0,w=s?s.attr(\"height\"):0,u=this.get(\"moveX\"),x=this.get(\"moveY\");if(s){s.scale(v/z.width,r/z.height);s.scale((v+q*t)/v,(r+o*t)/r);if(u!==null){s.attr(\"x\",u);this.set(\"moveX\",null)}if(x!==null){s.attr(\"y\",x);this.set(\"moveY\",null)}var p=s.getBBox();if(p.x>0){s.attr({x:0})}if(p.y>0){s.attr({y:0})}if((p.x+p.width)<z.width){s.attr({x:z.width-p.width})}if((p.y+p.height)<z.height){s.attr({y:z.height-p.height})}}}.observes(\"zoomLevel\"),resetInitialValues:function(){var b=this.get(\"dimensions\");if(b){this.set(\"imgWidth\",b.width);this.set(\"imgHeight\",b.height);this.set(\"initialWidth\",b.width);this.set(\"initialHeight\",b.height)}},createEditView:function(o,p,j){var k=this.get(\"editView\"),n=this.get(\"editShadeImage\"),l=this.get(\"editViewIsVisible\");if(k&&k.image&&k.rect&&!n){var m=k.image,i=k.rect;n=o.image(m,i.x,i.y,i.width,i.height);n.attr({\"clip-rect\":\"0, 0, %@, %@, %@\".fmt(p.width,p.height,j)});this.set(\"editShadeImage\",n)}if(n){if(l){n.show();n.toFront()}else{n.hide()}}return n},createInnerBoundaryRect:function(i){var s=this.get(\"boundaryRadius\"),w=this.get(\"dimensions\"),x=this.get(\"innerBoundaryRect\"),n=!SC.browser.isIE8OrLower,u=SC.browser.isWebkit;if(!x){var v=n?w.width:w.width-1,p=n?w.height:w.height-1,o=n?0:-1,q=n?0:-1,r=n?w.width:w.width+1,t=n?w.height:w.height+1;x=i.rect(0,0,v,p,s);x.attr({stroke:\"#000\",\"stroke-opacity\":\"0.6\",\"clip-rect\":\"%@, %@, %@, %@, %@\".fmt(o,q,r,t,s)});this.set(\"innerBoundaryRect\",x)}x.show();x.toFront()},editViewIsVisibleObserver:function(){var d=this.get(\"editShadeImage\"),f=this.get(\"editViewIsVisible\"),e=this.get(\"imgLoadError\");if(d){if(f&&!e){d.show();d.toFront()}else{d.hide()}}}.observes(\"editViewIsVisible\"),setupOrientation:function(){var h=this.get(\"imgOrientation\"),e=this.get(\"img\"),g=this.get(\"lastRotation\"),f;switch(h){case 3:f=e.rotate(180-this.get(\"lastRotation\"));this.set(\"lastRotation\",180);break;case 6:f=e.rotate(90-this.get(\"lastRotation\"));this.set(\"lastRotation\",90);break;case 8:f=e.rotate(-90-this.get(\"lastRotation\"));this.set(\"lastRotation\",-90);break;default:if(this.get(\"lastRotation\")!==0){e.rotate(0-this.get(\"lastRotation\"));this.set(\"lastRotation\",0)}}},resetRaphaelViews:function(){var e=this.get(\"img\"),f=this.get(\"innerBoundaryRect\"),d=this.get(\"editShadeImage\");if(e){e.remove();this.set(\"img\",null)}if(f){f.remove();this.set(\"innerBoundaryRect\",null)}if(d){d.remove();this.set(\"editShadeImage\",null)}}};CK.Photo.photoPickerLoadedCommonState=SC.State.extend({activeXFileDropped:function(b){this.invokeLater(function(){PhotoPicker.photoUploadController.fileDropped(b)},300)},uploadNewPhoto:function(){PhotoPicker.photoUploadController.uploadNewPhoto()},cancel:function(){PhotoPicker.photoUploadController.get(\"_imgPicker\").set(\"isVisible\",YES);if(SC.browser.isIE8OrLower){CW.notificationCenter.postNotification(\"cleanUpCanvas\");PhotoPicker.photoUploadController.cleanup()}this.gotoState(\"photoPickerUnloadedState\")},uploadingPhoto:function(){PhotoPicker.photoUploadController.setErrorViewsAndHoverViewsVisibility(NO,NO,CK.Photo.PHOTO_NO_ERROR);this.gotoState(\"photoPickerLoadedUploadedState\")},activeXFileDragStarted:function(){CW.notificationCenter.postNotification(\"activeXFileDragStarted\")},activeXFileDragEnded:function(){CW.notificationCenter.postNotification(\"activeXFileDragEnded\")},activeXFileDragged:function(b){CW.notificationCenter.postNotification(\"activeXFileDragged\",b)},activeXFileDragEnded:function(b){CW.notificationCenter.postNotification(\"activeXFileDragHasEnded\",b)},invalidFormat:function(){this.gotoState(\"invalidFormatErrorState\")},photoIsTooBig:function(){this.gotoState(\"photoTooBigErrorState\")},serverError:function(){this.gotoState(\"serverErrorState\")},activexAddOnRequired:function(){this.gotoState(\"activexAddOnRequiredErrorState\")},photoLoadError:function(){this.gotoState(\"photoLoadErrorState\")},uploadingPhotoCompleted:function(){this.gotoState(\"photoPickerLoadedInitialState\")}});sc_require(\"states/photo_loaded_state_common\");CK.Photo.photoPicker=SC.State.extend({initialSubstate:\"photoPickerUnloadedState\",photoPickerUnloadedState:SC.State.design({loadPhotoPicker:function(b){this.gotoState(\"photoPickerLoadedState\",{evt:b})},editPhoto:function(j,f,g){if(SteedOS.moduleLocalizer){var h=SteedOS.moduleLocalizer.localizedModules,i=SC.MODULE_INFO[\"cloudkit/photo/photoPicker\"];if(h.indexOf(\"cloudkit/photo/photoPicker\")===-1){h.pushObject(\"cloudkit/photo/photoPicker\");i.scriptURL=i.stringURL=SteedOS.moduleLocalizer._updateURL(i.scriptURL)}}SC.Module.loadModule(\"cloudkit/photo/photoPicker\",this,\"photoPickerDidLoad\",j)},photoPickerDidLoad:function(g,h){var e=SC.MODULE_INFO[\"cloudkit/photo/photoPicker\"],f=this.get(\"statechart\");if(f){h.statechart=f;f.sendAction(\"loadPhotoPicker\",h)}else{throw\"statechart not defined\"}}}),photoPickerLoadedState:SC.State.design({initialSubstate:\"photoPickerLoadedInitialState\",enterState:function(b){PhotoPicker.setupPicker(b)},photoPickerLoadedInitialState:CK.Photo.photoPickerLoadedCommonState.design({clickedOutside:function(c,d){this.cropPhoto(c.getPath(\"contentView.bottomContainer.buttons.done\"),d)},cropPhoto:function(d,e){var f=d.getPath(\"parentView.parentView.parentView.imageCropper\");f.cropPhoto();PhotoPicker.photoUploadController.get(\"_imgPicker\").set(\"isVisible\",NO)},closePicker:function(f,e){var d=PhotoPicker.photoUploadController;d.get(\"_imgPicker\").set(\"isVisible\",YES);if(d.get(\"isImageAltered\")){d.callExitAction()}this.gotoState(\"photoPickerUnloadedState\")}}),errorStates:CK.Photo.photoPickerLoadedCommonState.design({clickedOutside:function(){this.cancel()},invalidFormatErrorState:SC.State.design({enterState:function(){PhotoPicker.photoUploadController.setErrorViewsAndHoverViewsVisibility(YES,NO,CK.Photo.PHOTO_INVALID_FORMAT)}}),photoTooBigErrorState:SC.State.design({enterState:function(){PhotoPicker.photoUploadController.setErrorViewsAndHoverViewsVisibility(YES,NO,CK.Photo.PHOTO_SIZE_TOO_BIG)}}),serverErrorState:SC.State.design({enterState:function(){PhotoPicker.photoUploadController.setErrorViewsAndHoverViewsVisibility(YES,NO,CK.Photo.PHOTO_SERVER_ERROR)}}),activexAddOnRequiredErrorState:SC.State.design({enterState:function(){PhotoPicker.photoUploadController.setErrorViewsAndHoverViewsVisibility(YES,NO,CK.Photo.PHOTO_INSTALL_PLUGIN)}}),photoLoadErrorState:SC.State.design({enterState:function(){PhotoPicker.photoUploadController.setErrorViewsAndHoverViewsVisibility(YES,NO,CK.Photo.PHOTO_LOAD_ERROR)}})}),photoPickerLoadedUploadedState:SC.State.design({submitEvents:function(c,d){return YES}.handleEvents(\"clickedOutside\",\"uploadNewPhoto\",\"cropPhoto\"),uploadingPhotoCompleted:function(){this.gotoState(\"photoPickerLoadedInitialState\")},cancel:function(){PhotoPicker.photoUploadController.get(\"_imgPicker\").set(\"isVisible\",YES);if(SC.browser.isIE8OrLower){CW.notificationCenter.postNotification(\"cleanUpCanvas\");PhotoPicker.photoUploadController.cleanup()}this.gotoState(\"photoPickerUnloadedState\")}}),exitState:function(){PhotoPicker.photoUploadController.cleanup()},serverError:function(){this.gotoState(\"serverErrorState\")},photoLoadError:function(){this.gotoState(\"photoLoadErrorState\")}})});CK.Photo.Theme=SC.BaseTheme.create({name:\"photo\"});SC.Theme.addTheme(CK.Photo.Theme);sc_require(\"mixins/canvas_image\");CK.Photo.PhotoIconCanvasView=SC.View.extend(CK.Photo.CanvasImage,{status:null,zoomLevel:0,childViews:[\"spinner\"],staticImage:null,spinner:SC.View.extend({layout:{centerX:0,centerY:0,width:24,height:24},classNames:[\"spinner-24px-f3f5f5\"],isVisibleBinding:\"*parentView.isLoading\"}),didCreateLayer:function(b){b();this.createRaphael();this.invokeLater(function(){this.valueObserver()},50)}.enhance(),resetValues:function(){if(this.getPath(\"pane.isPaneAttached\")){this.set(\"currentValue\",null);this.set(\"currentPhotoCrop\",null);this.set(\"currentStaticImage\",null)}}.observes(\"*pane.isPaneAttached\"),createRaphael:function(){if(this.get(\"raphael\")){return}try{var f=this.get(\"frame\"),e=new Raphael(this.$()[0],f.width,f.height);this.set(\"raphael\",e)}catch(d){SC.error(\"Exception in creating Raphael is \"+d)}},isValueDataURL:function(){var b=this.get(\"value\");return b&&b.indexOf(\"data:image/jpeg;base64,\")===0}.property(\"value\"),valueObserver:function(){var k=this.get(\"value\"),h=this.get(\"photoCrop\"),j=this.get(\"staticImage\"),m=this.get(\"currentValue\"),n=this.get(\"currentPhotoCrop\"),i=this.get(\"currentStaticImage\"),l=this.get(\"raphael\");if(!l){return}if(m===k&&CW.valuesAreEqual(h,n)&&j===i){return}if(SC.browser.isIE8OrLower){l.remove();this.set(\"raphael\",null);this.createRaphael();this.resetRaphaelViews()}if(k){this.invokeLater(function(){if(!this.get(\"status\")){this.set(\"status\",\"loading\")}},300);this.set(\"status\",null);this.setImageWidthAndHeight(k,this,\"afterImageLoaded\",\"afterImageLoadingFailed\")}else{this.set(\"status\",\"loaded\");this.resetInitialValues();this.repositionImage()}this.set(\"currentValue\",k);this.set(\"currentPhotoCrop\",h);this.set(\"currentStaticImage\",j)}.observes(\"value\",\"photoCrop\",\"staticImage\"),afterImageLoaded:function(b){this.setupInitialDimensions(this.get(\"imgWidth\"),this.get(\"imgHeight\"));this.repositionImage();if(!(SC.browser.isIE8OrLower&&this.get(\"isValueDataURL\"))){this.set(\"status\",\"loaded\")}},afterImageLoadingFailed:function(b){this.set(\"status\",\"failed\");this.repositionImage()},isLoading:function(){var d=this.get(\"status\"),c=this.get(\"img\");if(d===\"loading\"){if(c){c.hide()}return YES}return NO}.property(\"status\")});";
